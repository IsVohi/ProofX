
const fs = require('fs');
const path = require('path');

const ZK_DIR = path.join(__dirname, '../zk-artifacts');
const OUT_FILE = path.join(__dirname, '../lib/zkArtifacts.ts');

const wasmPath = path.join(ZK_DIR, 'compliance.wasm');
const zkeyPath = path.join(ZK_DIR, 'circuit_final.zkey');

console.log('üîÑ Bundling ZK artifacts from:', ZK_DIR);

try {
    if (!fs.existsSync(wasmPath) || !fs.existsSync(zkeyPath)) {
        console.error('‚ùå ZK artifacts not found in zk-artifacts/');
        process.exit(1);
    }

    const wasmBase64 = fs.readFileSync(wasmPath, 'base64');
    const zkeyBase64 = fs.readFileSync(zkeyPath, 'base64');

    const content = `// Auto-generated by scripts/bundle-zk.js
// Do not edit manually

export const COMPLIANCE_WASM_B64 = "${wasmBase64}";
export const CIRCUIT_ZKEY_B64 = "${zkeyBase64}";
`;

    fs.writeFileSync(OUT_FILE, content);
    console.log('‚úÖ ZK artifacts bundled into lib/zkArtifacts.ts');

} catch (err) {
    console.error('‚ùå Failed to bundle ZK artifacts:', err);
    process.exit(1);
}
